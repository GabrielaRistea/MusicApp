@* @model Music_App.ViewModel.ReviewViewModel *@

@* <h2>Reviews</h2> *@

@* @* Formular de adăugare *@ 
@* <form asp-action="AddReview" method="post"> *@
@*     <input type="hidden" name="IdSong" value="@Model.NewReview.IdSong" /> *@

@*     <div class="form-group"> *@
@*         <label>Rating</label> *@
@*         <input name="Rating" class="form-control" type="number" step="0.5" min="0" max="5" value="@Model.NewReview.Rating" /> *@
@*     </div> *@
@*     <div class="form-group"> *@
@*         <label>Comment</label> *@
@*         <textarea name="Comm" class="form-control">@Model.NewReview.Comm</textarea> *@
@*     </div> *@
@*     <button type="submit" class="btn btn-primary">Add Review</button> *@
@* </form> *@

@* @* Lista de review-uri existente *@ 
@* @if (Model.Reviews != null && Model.Reviews.Any()) *@
@* { *@
@*     <ul> *@
@*         @foreach (var review in Model.Reviews) *@
@*         { *@
@*             <li> *@
@*                 <strong>@review.UserName</strong> *@
@*                 <strong>Rating:</strong> @review.Rating <br /> *@
@*                 <strong>Comment:</strong> @review.Comm *@
@*             </li> *@
@*         } *@
@*     </ul> *@
@* } *@
@* else *@
@* { *@
@*     <p>No comments.</p> *@
@* } *@

@model Music_App.ViewModel.ReviewViewModel

@{
    ViewData["Title"] = "Reviews";
}


@if (User.Identity.IsAuthenticated)
{
<h3 class="mt-4">Add commment</h3>

<form asp-action="AddReview" method="post" class="border rounded p-4 shadow-sm bg-dark text-white">
    <input type="hidden" name="IdSong" value="@Model.NewReview.IdSong" />

    <div class="mb-3">
        <label for="rating" class="form-label">Rating</label>
        <input id="rating" name="Rating" type="number" step="0.5" min="0" max="5"
               class="form-control bg-secondary text-white border-0"
               value="@Model.NewReview.Rating" />
    </div>

    <div class="mb-3">
        @* <label for="comm" class="form-label">Comment</label> *@
        <textarea id="comm" name="Comm"
                  class="form-control bg-secondary text-white border-0"
                  rows="4">@Model.NewReview.Comm</textarea>
    </div>

    <button type="submit" class="btn" style="background-color: #1DB954; color: white;">
        <i class="bi bi-plus-circle me-1"></i> Add Comment
    </button>
</form>
}

@if (Model.Reviews != null && Model.Reviews.Any())
{
    <p><strong>@Model.Reviews.Count</strong> comments</p>
    
    <ul class="list-unstyled">
        @foreach (var review in Model.Reviews)
        {
            <li class="d-flex mb-4 pb-3 border-bottom">
         
                <div class="me-3">
                    @if (review.ProfilPicture != null)
                    {
                        var base64 = Convert.ToBase64String(review.ProfilPicture);
                        var imgSrc = $"data:image/png;base64,{base64}";
                        <img src="@imgSrc"
                             class="rounded-circle"
                             width="60"
                             height="60"
                             style="object-fit: cover;" />
                    }
                    
                    else
                    {
                        <img src="/images/default-user.png"
                         class="rounded-circle"
                         width="60"
                         height="60"
                         style="object-fit: cover;" />
                    }
                </div>

                <div>
                    <div class="fw-bold">@review.UserName</div>
                    <div class="d-flex align-items-center mb-1">
                        <span class="badge bg-secondary me-2">⭐ @review.Rating</span>
                        <small class="text-muted">@review.Date</small>
                    </div>
                    <div style="white-space: pre-wrap;">@review.Comm</div>
                </div>
            </li>
        }
    </ul>


}
else
{
    <p class="text-muted">No comments yet.</p>
}
